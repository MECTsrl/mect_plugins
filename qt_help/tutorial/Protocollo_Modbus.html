
<html>
	<head>
	  <meta http-equiv="content-type" content="text/html; charset=windows-1252"/>
	   <title>Protocollo Modbus</title>
	   <style type="text/css">
		@page { size: 21.59cm 27.94cm; margin-right: 2cm; margin-top: 2.5cm; margin-bottom: 1.5cm }
		p { margin-bottom: 0.21cm; direction: ltr; color: #000000; orphans: 0; widows: 0 }
		p.western { font-family: "Arial", "Times New Roman", serif; font-size: 10pt; so-language: it-IT }
		h3.western { font-family: "Liberation Sans", "Arial", sans-serif; so-language: it-IT }
		a:link { color: #0000ff }
		a.cjk:visited { so-language: zh-CN }
	</style>
	</head>	
	<body>
		<h3 class="western">Protocollo Modbus</h3>
	<p class="western">Nei dispositivi Mect è possibile usare i protocolli di tipo Modbus/TCP e Modbus/RTU:</p>
	<ul>
		<li/>
		<p class="western">in modalità Master(Client) per accedere a registri su device esterni collegati, rispettivamente, via TCP/IP oppure via seriale (RS485/RS422).</p>
		<li/>
		<p class="western">in modalità Server(Slave) per esporre registri a device esterni collegati come sopra.</p>
	</ul>
	<p class="western">Nel Crosstable Editor:</p>
	<table width="500" cellpadding="9" cellspacing="0">
			<col width="250">
			<col width="250">
			<col width="250">
			<thead>
				<tr valign="top">
					<th width="250" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
						<p class="western"></p>
					</th>
					<th width="250" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Modbus TCP</p>
					</th>
					<th width="250" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 0px solid #000000; border-right: 1px solid #000000; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Modbus RTU</p>
					</th>
				</tr>
			</thead>
			<tbody>
				<tr valign="top">
					<td width="250" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western"><strong>Master (Client)</strong></p>
					</td>
					<td width="250"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western"><strong>TCP</strong></p>
					</td>
					<td width="250"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 0px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western"><strong>RTU</strong></p>
					</td>
				</tr>
				<tr valign="top">
					<td width="250" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western"><strong>Server (Slave)</strong></p>
					</td>
					<td width="250"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western"><strong>TCP_SRV</strong></p>
					</td>
					<td width="250"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 0px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western"><strong>RTU_SRV</strong></p>
					</td>
				</tr>
			</tbody>
		</table>
	<p class="western">L’utilizzo dei protocolli Modbus è molto semplice in quanto non occorre fare chiamate a funzione per leggere i registri via Modbus. I registri Modbus devono essere associati a variabili all’interno del “Crosstable Editor” e si specifica un “Read period”: quindi il sistema aggiorna automaticamente le variabili, secondo il periodo specificato e gestendo gli eventuali errori di comunicazione. Inoltre, la scrittura delle variabili (sia da HMI sia da PLC) provoca l’immediata scrittura via Modbus del registro corrispondente.</p>	
	<p class="western"><u>È tuttavia importante specificare dei “Read period” corretti</u>.</p>	
	<p class="western"><u>Se sono troppo brevi oppure ci sono troppi registri sullo stesso device allora il sistema non potrà aggiornare tutte le variabili</u>.</p>
	<p class="western"><u>Per facilitare la scelta si consiglia di usare il Tab &ldquo;<font color="#0000ff"><u><a class="western" href="Timings.html">Timings</a></u></font>&rdquo; nel Crosstable Editor</u>.</p>
	
	<p class="western">Nel campo (Register) bisogna riportare l’offset del registro (a volte chiamato indice o indirizzo o numero). Ricordiamo che i registri Modbus sono a 16 bit, quindi:</p>
	<ul>
		<li/>
		<p class="western">se (Type) è a 8 o 16 (per esempio BIT, INT, …) allora l’offset del registro successivo è “+1”.</p>
		<li/>
		<p class="western">se (Type) è a 32 bit (per esempio DWORD_BIT, REAL, UDINT, DINT, ...) allora l’offset del registro successivo è “+2”.</p>
	</ul>
	<p class="western">Inoltre:</p>
	<ul>
		<li/>
		<p class="western">se la variabile è con (Type) BIT allora il sistema userà automaticamente le funzioni:</p>
			<ul>
				<li/>
				<p class="western">"0x01 Read Coils"</p>
				<li/>
				<p class="western">"0x05 Write Single Coil"</p>
				<li/>
				<p class="western">"0x15 Write Multiple Coils"</p>
			</ul>
		<li/>
		<p class="western">se è stato specificato “Input register” allora il sistema  userà automaticamente la funzione “0x04 Read Input Registers”.</p>
		<li/>
		<p class="western">altrimenti il sistema userà automaticamente le funzioni:</p> 
		<ul>
			<li/>
			<p class="western">"0x03 Read Holding Register"</p>
			<li/>
			<p class="western">"0x06 Write Single Register"</p>
			<li/>
			<p class="western">"0x10 Write Multiple Registers"</p>
		</ul>		
	</ul>
	<br/>
	<p class="western"><strong><u>Definizione della variabile quando il plc è Master/Client</u>:</strong></p>
	<ul>
		<li/>
		<p class="western">RTU</p>
			<ul>
			<li/>
			<p class="western">(Priority) - 2 (linea guida, non obbligatorio).</p>
			<li/>
			<p class="western">(Protocol) - RTU.</p>
			<li/>
			<p class="western">(Node ID) - da 1 a 247.</p>
			<li/>
			<p class="western">(Register) - da 0 a 65535.</p>
			</ul>
		<li/>
		<p class="western">TCP</p>
			<ul>
			<li/>
			<p class="western">(Priority) - 3 (linea guida, non obbligatorio).</p>
			<li/>
			<p class="western">(Protocol) - TCP.</p>
			<li/>
			<p class="western">(IP Address) - x.x.x.x (server/slave).</p>
			<li/>
			<p class="western">(Port) - 502.</p>
			<li/>
			<p class="western">(Node ID) - da 0 a 255.</p>
			<li/>
			<p class="western">(Register) - da 0 a 65535.</p>
			</ul>
	</ul>
	<table width="600" cellpadding="8" cellspacing="0">
			<col width="300">
			<col width="300">
			<thead>
				<tr valign="top">
					<th width="300" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
						<p class="western">Master / client = TPAC (sia TCP sia RTU)</p>
					</th>
					<th width="300" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Server / slave = device esterno</p>
					</th>					
				</tr>
			</thead>
			<tbody>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Type: <strong>BIT</strong></p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">"0x01 Read Coils"<br> "0x05 Write Single Coil"<br> "0x15 Write Multiple Coils"</p>
					</td>
				</tr>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Type: <strong>tutti gli altri</strong></p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">“0x03 Read Holding Register”<br> “0x06 Write Single Register”<br> “0x10 Write Multiple Registers”</p>
					</td>
				</tr>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western"><strong>Input register</strong></p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">“0x04 Read Input Registers”</p>
					</td>
				</tr>
			</tbody>
		</table>
		<br/>
		<p class="western"><strong><u>Definizione della variabile quando il plc è Server/Slave</u>:</strong></p>
	<ul>
		<li/>
		<p class="western">RTU_SRV</p>
			<ul>
			<li/>
			<p class="western">(Priority) - 2 (linea guida, non obbligatorio).</p>
			<li/>
			<p class="western">(Type) - non accetta BIT, è possibile usare WORD_BIT.</p>
			<li/>
			<p class="western">(Protocol) - RTU_SRV.</p>
			<li/>
			<p class="western">(Node ID) - da 1 a 247.</p>
			<li/>
			<p class="western">(Register) - da 0 a <strong>4095</strong>.</p>
			<li/>
			<p class="western">(Behavior) - RW se la logica plc deve scrivere la variabile, RO se è solo scritta dai device esterni.</p>
			</ul>
		<li/>
		<p class="western">TCP_SRV</p>
			<ul>
			<li/>
			<p class="western">(Priority) - 3 (linea guida, non obbligatorio).</p>
			<li/>
			<p class="western">(Type) - non accetta BIT, è possibile usare WORD_BIT.</p>
			<li/>
			<p class="western">(Protocol) - TCP_SRV.</p>
			<li/>
			<p class="western">(IP Address) - 0.0.0.0</p>
			<li/>
			<p class="western">(Port) - 502.</p>
			<li/>
			<p class="western">(Node ID) - 1 (accetta solo 1).</p>
			<li/>
			<p class="western">(Register) - da 0 a <strong>4095</strong>.</p>
			<li/>
			<p class="western">(Behavior) - RW se la logica plc deve scrivere la variabile, RO se è solo scritta dai device esterni.</p>
			</ul>
	</ul>
	<table width="600" cellpadding="8" cellspacing="0">
			<col width="300">
			<col width="300">
			<thead>
				<tr valign="top">
					<th width="300" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
						<p class="western">Master / client = device esterno</p>
					</th>
					<th width="300" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">Server / slave = TPAC<br>(sia TCP_SRV sia RTU_SRV)</p>
					</th>					
				</tr>
			</thead>
			<tbody>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">"0x01 Read Coils"<br> "0x05 Write Single Coil"<br> "0x15 Write Multiple Coils"</p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">NON PERMESSO</p>
					</td>
				</tr>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">“0x03 Read Holding Register”<br> “0x06 Write Single Register”<br> “0x10 Write Multiple Registers”</p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">Type: <strong>tutti salvo BIT</strong></p>
					</td>
				</tr>
				<tr valign="top">
					<td width="300" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
						<p class="western">“0x04 Read Input Registers”</p>
					</td>
					<td width="300"  style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm" align="center">
					<p class="western">NON PERMESSO</p>
					</td>
				</tr>
			</tbody>
		</table>
	<br/>
	<p class="western"><strong><u>CONFIGURAZIONE MODBUS</u>:</strong></p>
	<p class="western">Dopo aver inserito nella Crosstable le variabili con i registri Modbus, occorre verificare le tempistiche di lettura del bus (vedere il capitolo &ldquo;<font color="#0000ff"><u><a class="western" href="Timings.html">Timings</a></u></font>&rdquo;). </p>
	<p class="western">Il campo “Priority” (2) e (3) associa un tempo di lettura alle variabili che hanno quella determinata priorità. Per modificare questi tempi andare nel &ldquo;<font color="#0000ff"><u><a class="western" href="System_Editor.html">System Editor</a></u></font>&rdquo;, sotto la voce “System” -> “Read Period 2 [ms]” e “Read Period 3 [ms]”.  </p>
	<p class="western">Per modificare “Baudrate”, “Timeout” e “Silence” andare nel System Editor -> “SERIAL PORT x” </p>
	<br/>
	</body>
</html>